{% extends 'base.html' %}
{% block content %}

<!-- Page Header -->
<div class="mb-4 mt-3">
    <h2 class="fw-semibold">Subscriptions</h2>
</div>

<div class="glass-card">

    <!-- ================= DESKTOP TABLE ================= -->
    <div class="desktop-table">
        <table class="table modern-table align-middle">
            <thead>
                <tr>
                    <th>S.No</th>
                    <th>Member</th>
                    <th>Plan</th>
                    <th>Expiry Date</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for sub in subscriptions %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ sub.member.name }}</td>
                    <td>{{ sub.plan.name }}</td>
                    <td>{{ sub.expiry_date }}</td>

                    <td>
                        {% if sub.expiry_date > today_plus_3 %}
                            <span class="badge bg-success">Active</span>
                        {% elif sub.expiry_date >= today %}
                            <span class="badge bg-warning text-dark">Expiring Soon</span>
                        {% else %}
                            <span class="badge bg-danger">Expired</span>
                        {% endif %}
                    </td>

                    <td>
                        {% if sub.expiry_date <= today_plus_3 %}
                            <a href="{% url 'renew_subscription' sub.id %}" 
                               class="btn-modern btn-sm">
                                Renew
                            </a>
                        {% else %}
                            <span class="text-muted">â€”</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center text-muted py-4">
                        No subscriptions found.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- ================= MOBILE CARD VIEW ================= -->
    <div class="mobile-cards">
        {% for sub in subscriptions %}
        <div class="subscription-card">

            <div><strong>Member:</strong> {{ sub.member.name }}</div>
            <div><strong>Plan:</strong> {{ sub.plan.name }}</div>
            <div><strong>Expiry:</strong> {{ sub.expiry_date }}</div>

            <div class="mt-2">
                {% if sub.expiry_date > today_plus_3 %}
                    <span class="badge bg-success">Active</span>
                {% elif sub.expiry_date >= today %}
                    <span class="badge bg-warning text-dark">Expiring Soon</span>
                {% else %}
                    <span class="badge bg-danger">Expired</span>
                {% endif %}
            </div>

            {% if sub.expiry_date <= today_plus_3 %}
            <div class="mt-3">
                <a href="{% url 'renew_subscription' sub.id %}" 
                   class="btn-modern btn-sm w-100 text-center">
                    Renew 
                </a>
            </div>
            {% endif %}

        </div>
        {% empty %}
        <p class="text-muted text-center">No subscriptions found.</p>
        {% endfor %}
    </div>

</div>

<!-- Add Subscription Button -->
<div class="d-flex justify-content-center mt-4">
    <a href="{% url 'add_subscription' %}" class="btn-modern text-center">
         Add Subscription
    </a>
</div>

<style>

/* Hide mobile cards on desktop */
.mobile-cards {
    display: none;
}

/* ================= MOBILE RESPONSIVE ================= */

@media (max-width: 768px) {

    .desktop-table {
        display: none;
    }

    .mobile-cards {
        display: block;
    }

    .subscription-card {
        background: #ffffff;
        padding: 15px;
        border-radius: 12px;
        margin-bottom: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        font-size: 14px;
    }

    .subscription-card strong {
        color: #555;
    }

    h2 {
        font-size: 22px;
    }
}

</style>

{% endblock %}
